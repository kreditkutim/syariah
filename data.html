<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="Kredit Syariah di Sangatta dengan prinsip transparan dan tanpa riba" />
    <title>(KSS) Kredit Syariah Sangatta</title>
    <style>
        /* [Styles tetap sama seperti sebelumnya] */
        
        /* Tambahan style untuk hasil */
        .loading { 
            color: #666; 
            text-align: center; 
            padding: 15px;
        }
        .error { 
            color: #d32f2f; 
            padding: 15px; 
            background: #ffebee;
            border-radius: 8px;
            margin-top: 15px;
        }
        .result { 
            background: #f5f5f5; 
            padding: 20px; 
            border-radius: 8px;
            margin-top: 15px;
        }
        .result ul {
            padding-left: 20px;
        }
        .result li {
            margin-bottom: 8px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>Cek Data Kredit Anda</h2>
        <label for="kode">Kode Konsumen:</label>
        <input type="text" id="kode" placeholder="Contoh: 2405">
        <button onclick="cekData()">Cek Data</button>
        <div id="hasil"></div>
    </div>

    <script>
        async function cekData() {
            const kode = document.getElementById('kode').value.trim();
            const hasilDiv = document.getElementById('hasil');
            
            // Validasi input
            if (!kode) {
                hasilDiv.innerHTML = '<div class="error">Harap masukkan kode konsumen</div>';
                return;
            }

            // Tampilkan loading
            hasilDiv.innerHTML = '<div class="loading">Sedang memeriksa data...</div>';

            try {
                // Kirim request ke Google Apps Script
                const response = await fetch(`https://script.google.com/macros/s/AKfycbxvYjBtRMAXcUHdj6bRVpEMKHQbv-a0H-Q9BK1z53GxzwMbo2S6iOchNNltvC_7LDUf/exec?kode=${encodeURIComponent(kode)}`);
                
                // Handle response error
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Handle error dari server
                if (data.error) {
                    hasilDiv.innerHTML = `<div class="error">${data.error}</div>`;
                    return;
                }

                // Hitung total pembayaran dan sisa
                const totalBayar = data.data.cicilan.reduce((total, cicilan) => total + Number(cicilan.nominal), 0);
                const sisa = Number(data.data.harga) - totalBayar;

                // Format tampilan hasil
                hasilDiv.innerHTML = `
                    <div class="result">
                        <h3>${data.data.nama}</h3>
                        <p><strong>Kode:</strong> ${data.data.kode}</p>
                        <p><strong>Barang:</strong> ${data.data.barang}</p>
                        <p><strong>Total Kredit:</strong> Rp ${Number(data.data.harga).toLocaleString('id-ID')}</p>
                        <p><strong>Total Dibayar:</strong> Rp ${totalBayar.toLocaleString('id-ID')}</p>
                        <p><strong>Sisa Pembayaran:</strong> Rp ${sisa.toLocaleString('id-ID')}</p>
                        
                        ${data.data.cicilan.length > 0 ? `
                            <h4>Riwayat Pembayaran:</h4>
                            <ul>
                                ${data.data.cicilan.map(cicilan => `
                                    <li>
                                        <strong>${cicilan.tanggal}:</strong> 
                                        Rp ${Number(cicilan.nominal).toLocaleString('id-ID')}
                                    </li>
                                `).join('')}
                            </ul>
                        ` : '<p>Belum ada riwayat pembayaran</p>'}
                    </div>
                `;

            } catch (error) {
                console.error('Error:', error);
                hasilDiv.innerHTML = `
                    <div class="error">
                        Terjadi kesalahan saat mengambil data:<br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>

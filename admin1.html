<!DOCTYPE html>
<html>
<head>
  <title>Panel Admin Kredit Syariah</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8f8f8; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
    input { padding: 6px; margin-right: 10px; }
    .summary { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>

  <h2>Halaman Admin - Data Kredit Konsumen</h2>
<label for="bulanSelect">Pilih Bulan:</label>
<select id="bulanSelect">
  <option value="">Semua Bulan</option>
  <option value="01">Januari</option>
  <option value="02">Februari</option>
  <option value="03">Maret</option>
  <option value="04">April</option>
  <option value="05">Mei</option>
  <option value="06">Juni</option>
  <option value="07">Juli</option>
  <option value="08">Agustus</option>
  <option value="09">September</option>
  <option value="10">Oktober</option>
  <option value="11">November</option>
  <option value="12">Desember</option>
</select>

<label for="tahunInput">Tahun:</label>
<input type="number" id="tahunInput" placeholder="2025" style="width:80px">
<button onclick="filterByBulan()">Tampilkan</button>


  <table id="dataTabel">
    <thead>
      <tr>
        <th>Kode</th>
        <th>Nama</th>
        <th>Barang</th>
        <th>Harga</th>
        <th>Modal</th>
        <th>Cicilan/Bulan</th>
        <th>Lama</th>
        <th>Tanggal Mulai</th>
        <th>Status</th>
        <th>Total Bayar</th>
        <th>Keuntungan</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="summary" id="totalKeuntungan">Total Keuntungan: Rp 0</div>

  <script>
    function formatRupiah(angka) {
  if (!angka || isNaN(angka)) return 'Rp 0';
  return 'Rp ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}

 let allData = [];

async function loadData() {
  const res = await fetch('https://script.google.com/macros/s/AKfycbz5VJRylw-dvset6w_JhzVkgUZ1zW5viLtJTKDS7hPSgHuRDBu3vYxqBEHu4cqebfxu/exec');
  const json = await res.json();
  allData = json.data;
  tampilkanData(allData);
}

function tampilkanData(data) {
  const tbody = document.querySelector('#dataTabel tbody');
  tbody.innerHTML = '';

  let totalKeuntungan = 0;

  data.forEach(item => {
    const keuntungan = item.keuntungan ? parseInt(item.keuntungan.replace(/[^\d]/g, '')) : 0;
    totalKeuntungan += keuntungan;

    const row = `<tr>
      <td>${item.kode}</td>
      <td>${item.nama}</td>
      <td>${item.barang}</td>
      <td>${item.harga}</td>
      <td>${formatRupiah(item.modal)}</td>
      <td>${item.cicilanPerBulan}</td>
      <td>${item.lamaBulan}</td>
      <td>${item.tanggalMulai}</td>
      <td>${item.status}</td>
      <td>${item.totalBayar}</td>
      <td>${formatRupiah(keuntungan)}</td>
    </tr>`;
    tbody.innerHTML += row;
  });

  document.getElementById("totalKeuntungan").innerText = "Total Keuntungan: " + formatRupiah(totalKeuntungan);
}
function filterByBulan() {
  const bulan = document.getElementById("bulanSelect").value;
  const tahun = document.getElementById("tahunInput").value;
  
  if (!bulan || !tahun) {
    tampilkanData(allData); // Tampilkan semua jika kosong
    return;
  }

  const filtered = allData.filter(item => {
    const parts = item.tanggalMulai.split('/');
    const bulanItem = parts[1];
    const tahunItem = parts[2];
    return bulanItem === bulan && tahunItem === tahun;
  });

  tampilkanData(filtered);

  alert(`Terdapat ${filtered.length} pengajuan kredit pada bulan ${bulan}-${tahun}`);
}
loadData();
  </script>
</body>
</html>

